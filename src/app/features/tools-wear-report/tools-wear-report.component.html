<div class="container mt-4">
  <h1 class="mb-4 text-center">Reporte de Desgaste de Herramientas</h1>

  <!-- Búsqueda -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <input
      type="text"
      class="form-control w-50"
      [(ngModel)]="search"
      (input)="onSearch(search)"
      placeholder="Buscar herramienta, ubicación o tipo..."
    />
  </div>

  <!--  Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th (click)="onSortChange('code')" class="cursor-pointer">Código</th>
          <th (click)="onSortChange('tool_type_name')" class="cursor-pointer">Tipo</th>
          <th (click)="onSortChange('location_name')" class="cursor-pointer">Ubicación</th>
          <th (click)="onSortChange('location_code')" class="cursor-pointer">Código Ubicación</th>
          <th (click)="onSortChange('lifecycle_statuses')" class="cursor-pointer">Vida útil (%)</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let report of reportData">
          <td>{{ report.code }}</td>
          <td>{{ report.tool_type_name }}</td>
          <td>{{ report.location_name }}</td>
          <td>{{ report.location_code }}</td>
          <td>
            <div class="progress" style="height: 20px;">
              <div
                class="progress-bar"
                role="progressbar"
                [style.width.%]="report.lifecycle_statuses"
                [ngClass]="{
                  'bg-success': report.lifecycle_statuses > 60,
                  'bg-warning': report.lifecycle_statuses <= 60 && report.lifecycle_statuses > 30,
                  'bg-danger': report.lifecycle_statuses <= 30
                }"
              >
                {{ report.lifecycle_statuses }}%
              </div>
            </div>
          </td>
        </tr>

        <tr *ngIf="reportData.length === 0">
          <td colspan="5" class="text-center text-muted py-3">
            No se encontraron resultados
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mt-3 gap-2">
    <div>Total de registros: <strong>{{ total }}</strong></div>

    <ngb-pagination
      [collectionSize]="total"
      [(page)]="currentPage"
      [pageSize]="pageSize"
      (pageChange)="onPageChange($event)"
    ></ngb-pagination>

    <select class="form-select w-auto" [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange($event)">
      <option [ngValue]="5">5 por página</option>
      <option [ngValue]="10">10 por página</option>
      <option [ngValue]="20">20 por página</option>
    </select>
  </div>
</div>
